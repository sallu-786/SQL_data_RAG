<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin Page</title>
    <link rel="icon" src="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"/>
    <link rel="stylesheet" href="./static/admin.css"> <!-- Link to your CSS file -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>

  <body>
    <div class="container my-3">
      <h2>Add Entry in Data</h2>
      <form id="data-form">
        <div class="mb-3">
          <label for="keyword" class="form-label">Keyword</label>
          <input type="text" class="form-control" id="keyword" required />
        </div>
        <div class="mb-3">
          <label for="description" class="form-label">Description</label>
          <textarea
            class="form-control"
            id="description"
            rows="8"
            required
          ></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
        <!-- <button type="submit" class="btn btn-danger">Update Vector data</button> -->

        <!-- Status Message Container -->
        <div class="container my-3">
          <div id="status-msg" class="alert" style="display: none"></div>
        </div>
      </form>
    </div>

    <div class="container my-3">
      <h2>Your Data</h2>
      <table class="table">
        <thead>
          <tr>
            <th scope="col" class="col-actions">Actions</th>
            <th scope="col" class="col-index">Index</th>
            <th scope="col" class="col-keyword">Keyword</th>
            <th scope="col" class="col-description">Description</th>
          </tr>
        </thead>
        <tbody id="data-table"></tbody>
      </table>
    </div>

    <!-- ------------------------------------------------Script to handle Data-------------------------->

    <script>
      $(document).ready(function () {
        // Function to load data into the table
        function loadData() {
          $.getJSON("/api/data", function (data) {
            let rows = "";
            $.each(data, function (index, item) {
              rows += `<tr>
                      <td>
                        <button class="btn btn-warning btn-sm edit-btn" data-id="${
                          item.id
                        }">Edit</button>
                        <button class="btn btn-danger btn-sm delete-btn" data-id="${
                          item.id
                        }">Delete</button>
                      </td>
                      <td>${
                        index + 1
                      }</td> <!-- Use index + 1 for 1-based index -->
                      <td>${item.Keyword}</td>
                      <td>${item.Description}</td>
                    </tr>`;
            });
            $("#data-table").html(rows);
          });
        }

        // Load data on page load
        loadData();

        // Handle form submission for adding data----------------------------------------------
        $("#data-form").submit(function (e) {
          e.preventDefault();
          const data = {
            Keyword: $("#keyword").val(),
            Description: $("#description").val(),
          };
          $.ajax({
            url: "/api/data",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify(data),
            success: function () {
              $("#keyword").val("");
              $("#description").val("");
              loadData();
              $("#status-msg")
                .removeClass()
                .addClass("alert alert-success")
                .text("Data added successfully.")
                .show()
                .delay(3000)
                .fadeOut();
            },
            error: function () {
              $("#status-msg")
                .removeClass()
                .addClass("alert alert-danger")
                .text("Failed to add data.")
                .show()
                .delay(3000)
                .fadeOut();
            },
          });
        });

        // Handle edit button click--------------------------------------------------------------
        $(document).on("click", ".edit-btn", function () {
          const id = $(this).data("id");
          $.getJSON(`/api/data/${id}`, function (data) {
            $("#keyword").val(data.Keyword);
            $("#description").val(data.Description);
            window.scrollTo(0, 0);

            // Update form submission to handle update
            $("#data-form")
              .off("submit")
              .submit(function (e) {
                e.preventDefault();
                const updatedData = {
                  Keyword: $("#keyword").val(),
                  Description: $("#description").val(),
                };
                $.ajax({
                  url: `/api/data/${id}`,
                  method: "PUT",
                  contentType: "application/json",
                  data: JSON.stringify(updatedData),
                  success: function () {
                    $("#keyword").val("");
                    $("#description").val("");
                    loadData();
                    $("#status-msg")
                      .removeClass()
                      .addClass("alert alert-success")
                      .text("Data updated successfully.")
                      .show()
                      .delay(3000)
                      .fadeOut();
                  },
                  error: function () {
                    $("#status-msg")
                      .removeClass()
                      .addClass("alert alert-danger")
                      .text("Failed to update data.")
                      .show()
                      .delay(3000)
                      .fadeOut();
                  },
                });
              });
          });
        });

        // Handle delete button click-----------------------------------------------------------------
        $(document).on("click", ".delete-btn", function () {
          const id = $(this).data("id");
          $.ajax({
            url: `/api/data/${id}`,
            method: "DELETE",
            success: function () {
              loadData();
              $("#status-msg")
                .removeClass()
                .addClass("alert alert-success")
                .text("Data deleted successfully.")
                .show()
                .delay(3000)
                .fadeOut();
            },
            error: function () {
              $("#status-msg")
                .removeClass()
                .addClass("alert alert-danger")
                .text("Failed to delete data.")
                .show()
                .delay(3000)
                .fadeOut();
            },
            
          });
          
        });
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
